# AES_CipherBook

<font size = 6 color = 'red'>**Hi, Github!**</font> 

## 写在前面

我是**Gandaove**，一个程序菜鸟。我注册Github账号已经有点年头了，一直在“学习”各个大佬们的代码，没想到，也有我上传代码的时候。是的，这是我的第一个上传至Github上的代码。

前几天我在刷网站，偶然发现了名为**1password**的工具，这引起了我的兴趣。我决定尝试做一个类似的东西。于是——它就这么产生了。



## 库的引用

* **Crypto.Cipher(pycryptodome)**: 它是最主要的库，提供了AES-256的核心加密算法
* **base64**: 将内容加密完后，由base64再次封装
* **os.system**: 系统库，主要用于暂停
* **time.sleep**: 主要用于显示暂停
* **hashlib**: 用于对密钥的哈希计算，下文会提到



## 编写环境

* Windows 10 64bit 20H2
* Python 3.9.5
* VSCode (pyinstaller打包)
* 后为兼顾兼容性使用Windows 7 64bit(Python 3.8.10)纯净环境打包



## 主要功能

这是一款能够将您的账号密码保存在一个本地文件的软件。为您的**cipherBook**添加密钥，并且记住它，按照软件提示操作，于是您就可以向其中添加您难以记住的密码了！



## 使用说明

* **Key**: 密钥
	**Question**: 您设置的提示句
	
* 注意：进入一级菜单时无论你想进行何种操作，您必须先输入文件路径。推荐每次输入文件路径时输入绝对路径(例：E:\Cache\xxx.key)。当您只输入文件名时，程序会在程序所在目录下寻找文件。
* 在您第一次使用时，需要创建一个cipherBook。请您在进入程序时选择**1**，然后按照菜单标注的操作来进行增删改查以及安全设置的更改。
	注意：您需要设置您的**Key、Question**以确保您可以正确使用您的cipherBook(若您未设置，**Key**将会初始化为*'None'*)，并确保在退出选项时选择'y'以保存您的密码本。(程序内有提示)
* 现在，您已经有了一个密码本。若想要进行查阅或更改，那么您需要输入您的**Key**。输入正确后，您可以进入如同您第一次创建cipherBook时见到的菜单。在您完成操作后，您可以选择是否保存更改。



## 核心逻辑

我打算建立一个存储在本地的文件密码本**cipherBook**。文件能够以加密明文存储，而其他人又无法从txt保存内容中轻易得知我的账号密码。只有掌握密钥**key**的您自己知道。

通过网站学习与我的“精心挑选”，最终我采用了目前较为普遍的**AES-256**加密的CBC模式，并以**PKCS7**标准填充。

那么这就需要几个参数: *Key, IV向量, 加密内容*

- *Key*：由于CBC的块加密特点，所以需要32bytes作为密钥。这里我将您的key的每个字母分别用**sha512**加密后连接，然后再将连接的字符串用**sha256**转为哈希的bytes格式，正好32bytes，以满足**AES-256**的要求

- *IV*：同理，IV则需要16bytes作为填充，为了不与Key相重复，我做了一点小小的改动：取**key**的前一半分别**sha512**加密后连接，再用**md5**加密转为哈希的bytes格式，为16bytes

- 加密内容：当然，也就是您想要存储的内容；采用字典储存。

  对于新版，格式更加自由，可不再拘束于旧版格式，允许嵌套；但仍然需要遵循基本的字典使用规则

  ```python
  dict = {'name':{'username': password}}			# 旧版格式示例
  
  
  '''									# level层级概念
  twitter:							# level1
  	account name: 111				# level2
  	password:
  		No.1: 000000				# level3
  		No.2: 654321
  	mention: Important!
  Gmail:								# level1
  	account_name: 1111@gmail.com
  	password: xxxx
  '''												# 新版格式示例
  ```

- 关于**PKCS7**  
	PKCS7规定了内容的一种填充标准，以保证AES-256(CBC)能正确地加密解密。一般情况下填充标准为16bytes，这里我设置为了32bytes。填充内容为ASCII字符(1~31)。
	
- **关于存储格式**

	实际上，目前没有严格规定存储格式。第一行的内容为您设置的提示句，采用明文保存；第二行的内容为**key**的二重哈希十六进制格式；第三行的内容为字典**dict**。

所以，加密的核心思路为：首先录入您需要保存的内容，然后将字典content转换为str，通过填充函数来填充十六进制字符；将您键入的Key通过二重哈希(sha256)加密作为**Key**，**Key**的前一半通过二重哈希(md5)加密作为IV，通过加密库加密，再用base64进一步打包。

~~我觉得我的方法还是有所创新的。~~ 



## 主要模块

* AES_cipherBook

  主函数部分，调用大模块

* Function

  进一步细化模块操作，创建、读取cipherBook以及操作部分

* Modify_dict

  密文的修改模块

* Security

  加密、验证模块

* File

  文件操作模块

* Menus

  菜单模块

* Error_res

  部分错误、退出处理模块

* Input

  输入模块(主要支持ctrl+c取消输入)



## 缺陷与潜力

当然，即便在方法上有所创新，项目依然需要进一步改进。本来这也算我一时冲动做出来的东西，从出现想法到第一个版本总共仅4天时间。

1. 过于依赖Python库。里面的很多方法非常依赖Python库，可以加入更多原创的方法。
2. ~~程序结构较为繁琐，有进一步优化空间。~~ 
3. 目前只进行了Windows适配。
3. 兼容性的潜在问题。
4. 没有设计GUI界面，黑色的控制台界面显得尤为单调。
4. 可添加多语言支持。
5. ~~存储形式较为单调，目前仅支持 `name:{username: password}`格式。~~ 
6. 我正在考虑向程序加入一些密码检测规则，对您的密码强度进行评估，并给出建议。
6. 明文内容易被破坏；文件存储格式可以进一步封装、加密。
6. cipherBook同步至某云端。



## 版本更新

### v1.0

这是我的第一个制作版本。



### v1.1

这是我的第一个上传版本。对程序结构进行进一步改良，修复了输入中文的出错问题，修复了若干小bug。出于兼容性考虑，我在 Windows7 虚拟机上的纯净环境进行了exe打包。



### v1.2

1.2版本为大更新。本次更新包括：

1. 代码重写。所有代码按功能模块化，增强可读性。
2. 更新哈希加密算法，使破解哈希更困难。
3. 去除密保**answer**设定，目前**question**可用作提示句。
4. 扩展存储格式。由原本仅存储账号密码扩展为更自由的格式。新增**level**层级概念。您可以无限扩展存储层级，也支持在同一层存储。
